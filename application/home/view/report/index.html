{extend name="public/common"}

{block name="style"}
<title>网上述职</title>
<link rel="stylesheet" href="/home/css/report/index.css">
<link rel="stylesheet" href="/home/css/common/rem.css">
<link rel="stylesheet" href="/home/css/all.css">
{/block}
{block name="body"}
<!--banner-->
<div class="reportSort">
    <div data-side="1" class="active"><span>组织述职</span><img src="/home/images/icon_001.png"></div>
    <div data-side="2"><span>个人风采</span></div>
    <div data-side="3"><span>活动展示</span></div>
</div>
<div class="reportDiv">
    <div class="reportDivSort" id="side1">
        <div class="banner"><img data-original="/home/images/banner/baogao.jpg" alt=""></div>
        <div class="reportDivmain">
            <ul>
                {volist name="list" id="vo"}
                <li>
                    <a href="{:Url('report/detail?id='.$vo['id'])}">
                        <div class="reportDivmainImg"><img src="/home/images/icon_002.jpg" alt=""></div>
                        <div class="reportDivmainText">
                            <div class="reportDivmainText_01">{$vo.title}</div>
                            <span class="reportDivmainText_02">投票数：{$vo.votes}</span>
                            <div class="reportDivmainText_03">{$vo['create_time']|time_format='Y-m-d'} <em class="fa"></em></div>
                        </div>
                    </a>
                </li>
                {/volist}
            </ul>
        </div>
    </div>
    <div class="reportDivSort" id="side2">
        <div class="banner"><img data-original="/home/images/banner/baogao.jpg" alt=""></div>
        <div class="reportDivmain">
            <ul>
                {volist name="list2" id="vo"}
                <li>
                    <a href="{:Url('style/detail?id='.$vo['id'])}">
                        <div class="reportDivmainImg"><div>{$vo.name}</div></div>
                        <div class="reportDivmainText">
                                <div class="reportDivmainText_04">{$vo.position}</div>
                                <div class="reportDivmainText_01">{$vo.title}</div>
                                <span class="reportDivmainText_02">点赞数：{$vo.votes}</span>
                                <div class="reportDivmainText_03">{$vo['create_time']|time_format='Y-m-d'} <em class="fa"></em></div>
                        </div>
                    </a>
                </li>
                {/volist}
            </ul>
        </div>
    </div>
    <div class="reportDivSort" id="side3"  style="display: block;">
        <div class="banner"><img data-original="/home/images/banner/baogao.jpg" alt=""></div>
        <div class="reportDivmain">
            <ul>
                {volist name="list3" id="vo"}
                <li>
                    <a href="{:Url('display/detail?id='.$vo['id'])}">
                        <div class="reportDivmainText">
                            <div class="reportDivmainText_04">
                                {$vo.title}
                            </div>
                            <div class="reportDivmainText_01">{$vo.content}</div>
                            <span class="reportDivmainText_02">打call数：{$vo.votes}</span>
                            <div class="reportDivmainText_03">{$vo['create_time']|time_format='Y-m-d'} <em class="fa"></em></div>
                        </div>
                    </a>
                </li>
                {/volist}
            </ul>
        </div>
    </div>
</div>
<!--列表-->
{/block}
{block name="script"}
<script>

    for(var i=0;i<$('.reportSort div').length;i++){
        $('.reportSort div')[i].onclick = function(){
            $('.reportSort div').removeClass('active').find('img').remove();
            $(this).addClass('active').append('<img src="/home/images/icon_001.png">');
            var side = $(this).data('side');
            $('.reportDivSort').hide();
            $('#side'+side).show();
        }
    }







    //初始化下拉加载
    mui.init({
        pullRefresh: {
            container: '#refreshContainer',
            up: {
                callback: loadScroll
            }
        }
    });

    function loadScroll(){
        var len = $(".main .re_list").length;
        $.ajax({
            url:"{:Url('Repotr/indexmore')}",
            data:{
                length:len,
            },
            beforeSend: function(XMLHttpRequest){
            },
            success:function(data){
                addCourse(data);
                if(data.code == 1){
                    if(data.data.length == 7){
                        mui('#refreshContainer').pullRefresh().endPullupToRefresh(false);
                    }else{
                        mui('#refreshContainer').pullRefresh().endPullupToRefresh(true);
                    }
                }else{
                    mui('#refreshContainer').pullRefresh().endPullupToRefresh(true);
                }
            }
        })
    };

    function addCourse(data) {
        console.log(data)
        var html = '';
        var lists = data.data;
        var len = lists.length;
        for (var i = 0; i < len; i++) {
            var list = lists[i];
            html += '<a  href="/hone/report/detail/type/1/id'+list.id+'" class="re_list">'+
                    '<div class="re_time">'+
                    ' <span class="month"><b>09</b>/09</span>'+
                    ' <span class="year">2017</span>'+
                    '</div>'+
                    ' <a class="re_info">'+
                    ' <h4 class=" title"></h4>'+
                    ' <div class="rep_text"> </div>'+
                    ' </a>'
        }
        $(".main").append(html);
    };

    //点击背景触发active
    mui("#refreshContainer").on("touchstart","a",function(){
        $(this).css("backgroundColor","rgba(0,0,0,.1)");
    }).on("touchend","a", function () {
        $(this).css("backgroundColor","#fff");
    });

    //页面点击事件
    mui("#refreshContainer").on("tap","a",function(){
        var url = this.getAttribute("href");
        window.location.href = url;
    })







</script>
{/block}